{"version":3,"file":"main.js","sourceRoot":"/","sources":["main.ts"],"names":[],"mappings":";;;AAAA,kFAAiF;AACjF,6DAA2F;AAK3F,MAAa,eAAgB,SAAQ,2BAAS;IAG5C,YAAY,MAAwC;QAClD,KAAK,CAAC,MAAM,CAAC,CAAC;QACd,IAAI,CAAC,OAAO,GAAG,IAAI,6BAAO,CAAC,MAAM,CAAC,CAAC;IACrC,CAAC;IAEK,GAAG,CAAC,IAA8B,EAAE,QAAuC;;YAC/E,MAAM,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC;YAE9B,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,EAAE;gBAC9B,MAAM,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;gBAC7B,OAAO,QAAQ,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;aAC7B;YAED,IAAI,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,EAAE;gBACjC,MAAM,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;gBAChC,OAAO,QAAQ,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;aAC7B;YAED,OAAO,QAAQ,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;QAC/B,CAAC;KAAA;IAEa,YAAY,CAAC,MAAsB;;YAC/C,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QAChC,CAAC;KAAA;IAEa,SAAS,CAAC,MAAmB;;YACzC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QAC7B,CAAC;KAAA;IAEO,aAAa,CAAC,MAAW;QAC/B,OAAO,MAAM,CAAC,EAAE,IAAI,MAAM,CAAC,EAAE,CAAC;IAChC,CAAC;IAEO,gBAAgB,CAAC,MAAW;QAClC,OAAO,MAAM,CAAC,EAAE,IAAI,MAAM,CAAC,EAAE,CAAC;IAChC,CAAC;CACF;AAvCD,0CAuCC","sourcesContent":["import { default as Transport, TransportStreamOptions } from 'winston-transport';\nimport { EventParams, PageviewParams, Visitor, VisitorOptions } from 'universal-analytics';\n\nexport type GoogleAnalyticsConstructorParams = TransportStreamOptions & VisitorOptions;\nexport type GoogleAnalyticsLogParams = { analytics: EventParams | PageviewParams };\n\nexport class GoogleAnalytics extends Transport {\n  private visitor: Visitor;\n\n  constructor(params: GoogleAnalyticsConstructorParams) {\n    super(params);\n    this.visitor = new Visitor(params);\n  }\n\n  async log(info: GoogleAnalyticsLogParams, callback: (_: any, __: boolean) => void) {\n    const params = info.analytics;\n\n    if (this.isEventParams(params)) {\n      await this.sendEvent(params);\n      return callback(null, true);\n    }\n\n    if (this.isPageviewParams(params)) {\n      await this.sendPageview(params);\n      return callback(null, true);\n    }\n\n    return callback(null, false);\n  }\n\n  private async sendPageview(params: PageviewParams) {\n    this.visitor.pageview(params);\n  }\n\n  private async sendEvent(params: EventParams) {\n    this.visitor.event(params);\n  }\n\n  private isEventParams(params: any): params is EventParams {\n    return params.ec && params.ea;\n  }\n\n  private isPageviewParams(params: any): params is PageviewParams {\n    return params.dp && params.dh;\n  }\n}\n"]}